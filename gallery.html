<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WeAreTheSpace Gallery</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  font-family: sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #f0f0f0;
}

.container {
  display: flex;
  flex-direction: column;
  width: 100%;
  height: 100%;
  align-items: center;
  justify-content: center;
}

a.back-arrow {
  font-size: 40px;
  text-decoration: none;
  color: #333;
  margin-bottom: 10px;
}

#galleryArea {
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}

.gallery-grid {
  display: grid;
  gap: 0;
}

.submission-tile {
  display: grid;
  gap: 0;
}

.submission-tile div {
  width: 100%;
  height: 100%;
}
</style>
</head>
<body>
<main class="container">
  <a href="https://someotherworld369-debug.github.io/wearethespace/" class="back-arrow">‚Üê</a>
  <div id="galleryArea"></div>
</main>

<script>
const API_BASE = 'https://wearethespace-backend.onrender.com';
const apiUrl = API_BASE.replace(/\/$/, '') + '/api/submissions';

const galleryArea = document.getElementById('galleryArea');

async function fetchFromApi() {
  try {
    const res = await fetch(apiUrl);
    if (!res.ok) throw new Error('API GET failed');
    const subs = await res.json();
    return subs.map(s => ({
      id: s.id,
      size: s.size,
      cells: s.cells
    }));
  } catch (err) {
    const fallback = JSON.parse(localStorage.getItem('artGridSubmissions') || '[]');
    return fallback;
  }
}

function makeDesignTile(sub, cellSize) {
  const tile = document.createElement('div');
  tile.className = 'submission-tile';
  tile.style.gridTemplateColumns = `repeat(${sub.size}, ${cellSize}px)`;
  tile.style.gridTemplateRows = `repeat(${sub.size}, ${cellSize}px)`;

  sub.cells.forEach(color => {
    const c = document.createElement('div');
    c.style.background = color || '#ffffff';
    tile.appendChild(c);
  });

  return tile;
}

function renderSubs(subs) {
  galleryArea.innerHTML = '';

  if (!subs.length) {
    galleryArea.innerHTML = '<p class="small-note">No submissions yet.</p>';
    return;
  }

  const totalSubs = subs.length;
  const dim = Math.ceil(Math.sqrt(totalSubs)); // number of tiles per row/column
  const container = document.createElement('div');
  container.className = 'gallery-grid';
  container.style.gridTemplateColumns = `repeat(${dim}, 1fr)`;
  container.style.gridTemplateRows = `repeat(${dim}, 1fr)`;
  container.style.width = '100%';
  container.style.height = '100%';
  container.style.gap = '0';

  // Find the maximum size of submission
  const maxSubSize = Math.max(...subs.map(s => s.size));

  // Calculate the maximum tile size to fit all submissions
  const tileWidth = Math.floor(galleryArea.clientWidth / dim / maxSubSize) * maxSubSize;
  const tileHeight = Math.floor(galleryArea.clientHeight / dim / maxSubSize) * maxSubSize;
  const tileSize = Math.min(tileWidth / maxSubSize, tileHeight / maxSubSize);

  subs.forEach(sub => {
    const tile = makeDesignTile(sub, tileSize);
    container.appendChild(tile);
  });

  galleryArea.appendChild(container);
}

async function loadAndRender() {
  const subs = await fetchFromApi();
  renderSubs(subs);
  setTimeout(loadAndRender, 2000);
}

window.addEventListener('resize', loadAndRender);
loadAndRender();
</script>
</body>
</html>
